<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>Risk Profili | YatÄ±rÄ±m AtlasÄ±</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & ROOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:      #f5f3ef;
  --card:    #ffffff;
  --ink:     #18181b;
  --ink2:    #3f3f46;
  --muted:   #a1a1aa;
  --border:  #e4e4e7;
  --blue:    #3b82f6;
  --blue-s:  #eff6ff;
  --green:   #22c55e;
  --amber:   #f59e0b;
  --red:     #ef4444;
  --r:       18px;
}

html {
  background: var(--bg);
  font-family: 'Inter', sans-serif;
  color: var(--ink);
  /* Hide scrollbar but allow scroll if content overflows on tiny screens */
  scrollbar-width: none;
  -ms-overflow-style: none;
}
html::-webkit-scrollbar { display: none; }

body {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 20px 16px 24px;
  scrollbar-width: none;
}
body::-webkit-scrollbar { display: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#prog-wrap {
  width: 100%;
  max-width: 500px;
  margin-bottom: 12px;
  flex-shrink: 0;
}
.prog-meta {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  letter-spacing: .04em;
  text-transform: uppercase;
  margin-bottom: 6px;
}
.prog-track {
  height: 4px;
  background: var(--border);
  border-radius: 99px;
  overflow: hidden;
}
.prog-fill {
  height: 100%;
  background: var(--ink);
  border-radius: 99px;
  transition: width .5s cubic-bezier(.4,0,.2,1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#card {
  width: 100%;
  max-width: 500px;
  background: var(--card);
  border-radius: var(--r);
  box-shadow:
    0 1px 2px rgba(0,0,0,.04),
    0 4px 16px rgba(0,0,0,.06),
    0 16px 40px rgba(0,0,0,.04);
  overflow: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTION LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.q-top {
  padding: 22px 24px 16px;
  border-bottom: 1px solid var(--border);
}
.q-cat {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: .1em;
  text-transform: uppercase;
  color: var(--blue);
  background: var(--blue-s);
  padding: 3px 10px;
  border-radius: 99px;
  margin-bottom: 11px;
}
.q-text {
  font-family: 'Playfair Display', serif;
  font-size: clamp(15px, 3.5vw, 19px);
  font-weight: 600;
  line-height: 1.4;
  color: var(--ink);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCALE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scale-wrap {
  padding: 16px 24px 18px;
}
.scale-hint {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: var(--muted);
  font-weight: 500;
  margin-bottom: 10px;
}
.scale-row {
  display: flex;
  gap: 6px;
}
.scale-row button {
  flex: 1;
  aspect-ratio: 1;
  border-radius: 10px;
  border: 1.5px solid var(--border);
  background: white;
  font-size: clamp(13px, 3vw, 16px);
  font-weight: 600;
  font-family: 'Inter', sans-serif;
  color: var(--ink2);
  cursor: pointer;
  transition: all .14s ease;
  -webkit-tap-highlight-color: transparent;
}
.scale-row button:active { transform: scale(.94); }
.scale-row button.sel {
  background: var(--ink);
  color: white;
  border-color: var(--ink);
  box-shadow: 0 3px 10px rgba(0,0,0,.18);
  transform: translateY(-2px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 24px 16px;
  border-top: 1px solid var(--border);
  gap: 10px;
}
.btn-back {
  font-size: 13px;
  font-weight: 500;
  color: var(--muted);
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px 4px;
  font-family: 'Inter', sans-serif;
  transition: color .15s;
  -webkit-tap-highlight-color: transparent;
  flex-shrink: 0;
}
.btn-back:hover { color: var(--ink); }
.btn-back:disabled { opacity: .25; cursor: default; }

.btn-next {
  font-size: 13px;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
  color: white;
  background: var(--ink);
  border: none;
  border-radius: 10px;
  padding: 10px 20px;
  cursor: pointer;
  transition: all .14s ease;
  -webkit-tap-highlight-color: transparent;
  flex-shrink: 0;
}
.btn-next:active { transform: scale(.97); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.login-wrap {
  padding: 28px 24px;
}
.login-wrap h2 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(20px, 5vw, 24px);
  margin-bottom: 6px;
}
.login-wrap p {
  font-size: 13px;
  color: var(--muted);
  line-height: 1.55;
  margin-bottom: 22px;
}
.field {
  width: 100%;
  padding: 11px 14px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: 14px;
  font-family: 'Inter', sans-serif;
  color: var(--ink);
  background: white;
  outline: none;
  transition: border-color .15s;
  margin-bottom: 10px;
  -webkit-appearance: none;
}
.field:focus { border-color: var(--ink); }
.btn-submit {
  width: 100%;
  padding: 13px;
  background: var(--ink);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
  cursor: pointer;
  margin-top: 4px;
  transition: all .14s;
  -webkit-tap-highlight-color: transparent;
}
.btn-submit:active { transform: scale(.98); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-wrap {
  padding: 24px 24px 28px;
}

/* Profile badge */
.profile-badge {
  display: flex;
  align-items: center;
  gap: 14px;
  background: var(--bg);
  border-radius: 12px;
  padding: 14px 16px;
  margin-bottom: 18px;
}
.profile-icon {
  font-size: 32px;
  line-height: 1;
  flex-shrink: 0;
}
.profile-info {}
.profile-label {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: .1em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 2px;
}
.profile-name {
  font-family: 'Playfair Display', serif;
  font-size: clamp(18px, 4.5vw, 22px);
  font-weight: 700;
  color: var(--ink);
}
.profile-score {
  font-size: 12px;
  color: var(--muted);
  margin-top: 1px;
}

/* Gauge bar */
.gauge-section {
  margin-bottom: 18px;
}
.gauge-labels {
  display: flex;
  justify-content: space-between;
  font-size: 9px;
  font-weight: 700;
  letter-spacing: .07em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 6px;
}
.gauge-track {
  height: 8px;
  background: var(--border);
  border-radius: 99px;
  overflow: visible;
  position: relative;
}
.gauge-fill {
  height: 100%;
  border-radius: 99px;
  transition: width 1.2s cubic-bezier(.4,0,.2,1) .4s;
  position: relative;
}
.gauge-thumb {
  position: absolute;
  right: -1px;
  top: 50%;
  transform: translateY(-50%);
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: white;
  border: 2px solid currentColor;
  box-shadow: 0 2px 6px rgba(0,0,0,.2);
}

/* Zones */
.gauge-zones {
  display: flex;
  gap: 4px;
  margin-top: 8px;
}
.zone {
  flex: 1;
  text-align: center;
  padding: 4px 2px;
  border-radius: 6px;
  font-size: 9px;
  font-weight: 600;
  letter-spacing: .03em;
}
.zone.z1 { background: #dcfce7; color: #15803d; }
.zone.z2 { background: #fef9c3; color: #92400e; }
.zone.z3 { background: #dbeafe; color: #1d4ed8; }
.zone.z4 { background: #fee2e2; color: #b91c1c; }
.zone.active { outline: 2px solid currentColor; outline-offset: 1px; }

/* Radar chart */
.chart-section {
  margin-bottom: 18px;
}
.chart-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  letter-spacing: .06em;
  text-transform: uppercase;
  margin-bottom: 10px;
}
.chart-box {
  position: relative;
  height: 200px;
}

/* Description */
.desc-card {
  background: var(--bg);
  border-radius: 10px;
  padding: 14px 16px;
  font-size: 13px;
  color: var(--ink2);
  line-height: 1.65;
  margin-bottom: 16px;
}
.desc-card strong {
  display: block;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 5px;
}

/* Alloc pills */
.alloc-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 18px;
}
.alloc-pill {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 99px;
  font-size: 12px;
  font-weight: 600;
  border: 1.5px solid var(--border);
}
.alloc-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.btn-reset {
  font-size: 12px;
  color: var(--muted);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: underline;
  text-underline-offset: 3px;
  font-family: 'Inter', sans-serif;
  display: block;
  margin: 0 auto;
  -webkit-tap-highlight-color: transparent;
}
.btn-reset:hover { color: var(--ink); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fadeSlideRight {
  from { opacity: 0; transform: translateX(24px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes fadeSlideLeft {
  from { opacity: 0; transform: translateX(-24px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}
.anim-right { animation: fadeSlideRight .2s ease forwards; }
.anim-left  { animation: fadeSlideLeft  .2s ease forwards; }
.anim-up    { animation: fadeIn         .3s ease forwards; }

@keyframes shake {
  0%,100% { transform: translateX(0); }
  20%     { transform: translateX(-7px); }
  60%     { transform: translateX(7px); }
}
.shake { animation: shake .25s ease; }
</style>
</head>
<body>

<!-- PROGRESS (hidden during login/result) -->
<div id="prog-wrap">
  <div class="prog-meta">
    <span id="prog-section">Risk AlgÄ±sÄ±</span>
    <span id="prog-num">1 / 30</span>
  </div>
  <div class="prog-track">
    <div class="prog-fill" id="prog-fill" style="width:3.3%"></div>
  </div>
</div>

<!-- MAIN CARD -->
<div id="card"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SECTIONS = [
  { key:"risk",    title:"Risk AlgÄ±sÄ±",          color:"#6366f1", questions:[
    "Piyasa %20 dÃ¼ÅŸtÃ¼ÄŸÃ¼nde pozisyonumu koruyabilirim.",
    "GeÃ§ici zararlar beni paniÄŸe sÃ¼rÃ¼klemez.",
    "DalgalÄ± piyasalarda sakin kalÄ±rÄ±m.",
    "PortfÃ¶y dÃ¼ÅŸÃ¼ÅŸlerinde stratejimi bozmam.",
    "Belirsizlik dÃ¶nemlerinde yatÄ±rÄ±m yapabilirim."
  ]},
  { key:"volat",   title:"Volatilite ToleransÄ±", color:"#8b5cf6", questions:[
    "YÃ¼ksek getiri iÃ§in risk alabilirim.",
    "GÃ¼nlÃ¼k fiyat deÄŸiÅŸimleri beni rahatsÄ±z etmez.",
    "Agresif yatÄ±rÄ±m araÃ§larÄ±na aÃ§Ä±ÄŸÄ±m.",
    "KÄ±sa vadeli kayÄ±plarÄ± tolere edebilirim.",
    "OynaklÄ±k fÄ±rsat yaratÄ±r."
  ]},
  { key:"zaman",   title:"Zaman Ufku",           color:"#3b82f6", questions:[
    "YatÄ±rÄ±mlarÄ±mÄ± uzun vadeli planlarÄ±m.",
    "En az 5 yÄ±l yatÄ±rÄ±mda kalabilirim.",
    "SabÄ±rlÄ± bir yatÄ±rÄ±mcÄ±yÄ±m.",
    "KÄ±sa vadeli kazanÃ§ Ã¶nceliÄŸim deÄŸildir.",
    "Uzun sÃ¼re bekleyebilirim."
  ]},
  { key:"dayanik", title:"Finansal DayanÄ±klÄ±lÄ±k", color:"#10b981", questions:[
    "Acil durum fonum var.",
    "BorÃ§ oranÄ±m dÃ¼ÅŸÃ¼k.",
    "Gelirim dÃ¼zenli.",
    "YatÄ±rÄ±m zararlarÄ± hayatÄ±mÄ± etkilemez.",
    "Nakit ihtiyacÄ±m dÃ¼ÅŸÃ¼k."
  ]},
  { key:"bilgi",   title:"Bilgi & Deneyim",      color:"#f59e0b", questions:[
    "Piyasa bilgim var.",
    "Daha Ã¶nce yatÄ±rÄ±m yaptÄ±m.",
    "Risk-getiri iliÅŸkisini bilirim.",
    "FarklÄ± varlÄ±k tÃ¼rlerini tanÄ±rÄ±m.",
    "Piyasa analizlerini takip ederim."
  ]},
  { key:"davran",  title:"DavranÄ±ÅŸsal Disiplin", color:"#ef4444", questions:[
    "Panik satÄ±ÅŸ yapmam.",
    "SÃ¼rÃ¼ psikolojisinden etkilenmem.",
    "Stratejime sadÄ±k kalÄ±rÄ±m.",
    "DuygularÄ±mÄ± kontrol ederim.",
    "AÅŸÄ±rÄ± Ã¶zgÃ¼venli karar almam."
  ]}
];

// Flatten all questions
const ALL_Q = [];
SECTIONS.forEach((s,si) => s.questions.forEach((q,qi) => ALL_Q.push({s,si,qi,text:q})));
const TOTAL = ALL_Q.length; // 30, max score = 150, min = 30

const PROFILES = [
  {
    min:30, max:74, name:"Koruma OdaklÄ±", icon:"ğŸ›¡ï¸",
    gradient:["#bbf7d0","#4ade80"],
    color:"#15803d",
    desc:"Sermayenizi korumayÄ± Ã¶n planda tutuyorsunuz. KÄ±sa vadeli kayÄ±plar sizi rahatsÄ±z ediyor ve gÃ¼venli liman varlÄ±klara yÃ¶neliyorsunuz.",
    suggestion:"Devlet tahvili, altÄ±n, mevduat ve dÃ¼ÅŸÃ¼k volatiliteli fonlar portfÃ¶yÃ¼nÃ¼zÃ¼n temelini oluÅŸturabilir.",
    alloc:[{l:"Tahvil/Mevduat",p:"50%",c:"#4ade80"},{l:"AltÄ±n",p:"25%",c:"#fbbf24"},{l:"Hisse",p:"15%",c:"#60a5fa"},{l:"DiÄŸer",p:"10%",c:"#a78bfa"}]
  },
  {
    min:75, max:104, name:"Dengeli", icon:"âš–ï¸",
    gradient:["#fef08a","#fbbf24"],
    color:"#92400e",
    desc:"Risk ve getiriyi dengelemeyi tercih ediyorsunuz. Makul getiri iÃ§in sÄ±nÄ±rlÄ± dÃ¼ÅŸÃ¼ÅŸleri kabul edebilirsiniz.",
    suggestion:"Karma portfÃ¶y, temettÃ¼ hisseleri ve orta vadeli tahvil kombinasyonu size uygun.",
    alloc:[{l:"Hisse",p:"40%",c:"#60a5fa"},{l:"Tahvil",p:"35%",c:"#4ade80"},{l:"AltÄ±n",p:"15%",c:"#fbbf24"},{l:"DiÄŸer",p:"10%",c:"#a78bfa"}]
  },
  {
    min:105, max:134, name:"BÃ¼yÃ¼me OdaklÄ±", icon:"ğŸ“ˆ",
    gradient:["#bfdbfe","#3b82f6"],
    color:"#1d4ed8",
    desc:"Uzun vadeli bÃ¼yÃ¼me iÃ§in geÃ§ici dalgalanmalarÄ± kaldÄ±rabiliyorsunuz. PiyasayÄ± yakÄ±ndan takip ediyor ve bilinÃ§li risk alÄ±yorsunuz.",
    suggestion:"Hisse aÄŸÄ±rlÄ±klÄ±, Ã§eÅŸitlendirilmiÅŸ bir portfÃ¶y. GeliÅŸmekte olan piyasalar ve bÃ¼yÃ¼me hisseleri radar da olabilir.",
    alloc:[{l:"Hisse",p:"60%",c:"#60a5fa"},{l:"Tahvil",p:"20%",c:"#4ade80"},{l:"AltÄ±n",p:"10%",c:"#fbbf24"},{l:"Kripto/DiÄŸer",p:"10%",c:"#a78bfa"}]
  },
  {
    min:135, max:150, name:"Agresif", icon:"ğŸš€",
    gradient:["#fecaca","#ef4444"],
    color:"#b91c1c",
    desc:"YÃ¼ksek getiri iÃ§in yÃ¼ksek riski gÃ¶ze alabiliyorsunuz. Volatiliteyi fÄ±rsat olarak gÃ¶rÃ¼yor, uzun vadeli dÃ¼ÅŸÃ¼nÃ¼yorsunuz.",
    suggestion:"YÃ¼ksek bÃ¼yÃ¼me potansiyelli hisseler, kripto para ve alternatif yatÄ±rÄ±m araÃ§larÄ± profilinize uygun.",
    alloc:[{l:"Hisse",p:"70%",c:"#60a5fa"},{l:"Kripto",p:"15%",c:"#a78bfa"},{l:"Tahvil",p:"10%",c:"#4ade80"},{l:"DiÄŸer",p:"5%",c:"#fbbf24"}]
  }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let cur = 0;
let ans = {};   // flat index â†’ 1..5
let user = null;
let radarChart = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const card     = document.getElementById("card");
const progWrap = document.getElementById("prog-wrap");
const progFill = document.getElementById("prog-fill");
const progSection = document.getElementById("prog-section");
const progNum     = document.getElementById("prog-num");

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateProg() {
  const pct = ((cur + 1) / TOTAL) * 100;
  progFill.style.width = Math.max(pct, 3.3) + "%";
  progSection.textContent = ALL_Q[Math.min(cur, TOTAL-1)].s.title;
  progNum.textContent = (cur+1) + " / " + TOTAL;
}

function setCard(html, anim) {
  card.innerHTML = html;
  card.className = "";
  if (anim) {
    void card.offsetWidth;
    card.classList.add(anim);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTION SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderQ(dir) {
  updateProg();
  progWrap.style.display = "";

  const q = ALL_Q[cur];
  const sel = ans[cur];
  const isLast = cur === TOTAL - 1;

  const btns = [1,2,3,4,5].map(v =>
    `<button class="${sel===v?'sel':''}" onclick="pick(${v})">${v}</button>`
  ).join("");

  setCard(`
    <div class="q-top">
      <div class="q-cat">${q.s.title}</div>
      <div class="q-text">${q.text}</div>
    </div>
    <div class="scale-wrap">
      <div class="scale-hint">
        <span>1 â€” HiÃ§ rahat deÄŸilim</span>
        <span>5 â€” Ã‡ok rahatÄ±m</span>
      </div>
      <div class="scale-row">${btns}</div>
    </div>
    <div class="nav">
      <button class="btn-back" onclick="goBack()" ${cur===0?"disabled":""}>â† Geri</button>
      <button class="btn-next" onclick="goNext()">${isLast?"Sonucu GÃ¶r âœ¦":"Ä°leri â†’"}</button>
    </div>
  `, dir === "right" ? "anim-right" : dir === "left" ? "anim-left" : null);
}

function pick(v) {
  ans[cur] = v;
  // re-render without animation to update button state
  const q = ALL_Q[cur];
  const isLast = cur === TOTAL - 1;
  const btns = [1,2,3,4,5].map(val =>
    `<button class="${v===val?'sel':''}" onclick="pick(${val})">${val}</button>`
  ).join("");
  card.innerHTML = `
    <div class="q-top">
      <div class="q-cat">${q.s.title}</div>
      <div class="q-text">${q.text}</div>
    </div>
    <div class="scale-wrap">
      <div class="scale-hint">
        <span>1 â€” HiÃ§ rahat deÄŸilim</span>
        <span>5 â€” Ã‡ok rahatÄ±m</span>
      </div>
      <div class="scale-row">${btns}</div>
    </div>
    <div class="nav">
      <button class="btn-back" onclick="goBack()" ${cur===0?"disabled":""}>â† Geri</button>
      <button class="btn-next" onclick="goNext()">${isLast?"Sonucu GÃ¶r âœ¦":"Ä°leri â†’"}</button>
    </div>
  `;
}

function goNext() {
  if (!ans[cur]) {
    card.classList.remove("shake");
    void card.offsetWidth;
    card.classList.add("shake");
    return;
  }
  if (cur < TOTAL - 1) { cur++; renderQ("right"); }
  else showLogin();
}

function goBack() {
  if (cur > 0) { cur--; renderQ("left"); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showLogin() {
  progWrap.style.display = "none";
  setCard(`
    <div class="login-wrap">
      <h2>Son bir adÄ±m.</h2>
      <p>Sonucunuzu gÃ¶rmek ve kaydetmek iÃ§in ad ve e-postanÄ±zÄ± girin. Bilgileriniz yalnÄ±zca profilinizi saklamak iÃ§in kullanÄ±lÄ±r.</p>
      <input class="field" id="f-name"  type="text"  placeholder="Ad Soyad" autocomplete="name"/>
      <input class="field" id="f-email" type="email" placeholder="E-posta adresi" autocomplete="email"/>
      <button class="btn-submit" onclick="doLogin()">Sonucumu GÃ¶r â†’</button>
    </div>
  `, "anim-up");

  // Auto-focus name on desktop
  setTimeout(() => {
    const el = document.getElementById("f-name");
    if (el) el.focus();
  }, 300);
}

function doLogin() {
  const name  = (document.getElementById("f-name").value||"").trim();
  const email = (document.getElementById("f-email").value||"").trim();
  if (!name || !email || !email.includes("@")) {
    const btn = document.querySelector(".btn-submit");
    btn.style.background = "#ef4444";
    setTimeout(() => btn.style.background = "", 800);
    return;
  }
  user = { name, email };
  localStorage.setItem("rp_user", JSON.stringify(user));

  const saved = localStorage.getItem("rp_result_" + email);
  if (saved) showResult(JSON.parse(saved));
  else computeResult();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPUTE + RESULT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function computeResult() {
  // Total score
  const total = Object.values(ans).reduce((a,b)=>a+b,0);

  // Per-section scores (0â€“25 each â†’ normalize to 0â€“100)
  const sectScores = SECTIONS.map((s,si) => {
    let sum = 0;
    s.questions.forEach((_,qi) => {
      const flatIdx = si*5 + qi;
      sum += (ans[flatIdx] || 1);
    });
    return Math.round((sum / 25) * 100);
  });

  const profile = PROFILES.find(p => total >= p.min && total <= p.max) || PROFILES[PROFILES.length-1];

  const data = {
    name: user.name, email: user.email,
    total, sectScores,
    profile: profile.name, icon: profile.icon,
    desc: profile.desc, suggestion: profile.suggestion,
    alloc: profile.alloc, color: profile.color,
    gradient: profile.gradient,
    date: new Date().toISOString()
  };

  localStorage.setItem("rp_result_" + user.email, JSON.stringify(data));
  showResult(data);
}

function showResult(data) {
  progWrap.style.display = "none";

  // Gauge fill percentage (30=min, 150=max range)
  const gaugePct = Math.round(((data.total - 30) / 120) * 100);
  const gaugeColor = data.color;

  // Alloc pills HTML
  const allocHTML = (data.alloc||[]).map(a =>
    `<div class="alloc-pill">
       <div class="alloc-dot" style="background:${a.c}"></div>
       <span>${a.l} <strong>${a.p}</strong></span>
     </div>`
  ).join("");

  // Zone highlight
  const zones = ["Koruma","Dengeli","BÃ¼yÃ¼me","Agresif"];
  const activeZone = zones.indexOf(["Koruma OdaklÄ±","Dengeli","BÃ¼yÃ¼me OdaklÄ±","Agresif"]
    .find(n => data.profile.includes(n.split(" ")[0])));
  const zonesHTML = zones.map((z,i) =>
    `<div class="zone z${i+1} ${i===activeZone?'active':''}">${z}</div>`
  ).join("");

  setCard(`
    <div class="result-wrap">

      <!-- Profile Badge -->
      <div class="profile-badge">
        <div class="profile-icon">${data.icon}</div>
        <div class="profile-info">
          <div class="profile-label">Risk Profiliniz</div>
          <div class="profile-name">${data.profile}</div>
          <div class="profile-score">Skor: ${data.total} / 150</div>
        </div>
      </div>

      <!-- Gauge -->
      <div class="gauge-section">
        <div class="gauge-labels">
          <span>DÃ¼ÅŸÃ¼k Risk</span>
          <span>YÃ¼ksek Risk</span>
        </div>
        <div class="gauge-track">
          <div class="gauge-fill" id="g-fill"
               style="width:0%; background: linear-gradient(90deg, ${data.gradient[0]}, ${data.gradient[1]}); color:${gaugeColor}">
            <div class="gauge-thumb"></div>
          </div>
        </div>
        <div class="gauge-zones" style="margin-top:8px">${zonesHTML}</div>
      </div>

      <!-- Radar Chart -->
      <div class="chart-section">
        <div class="chart-title">Kategori BazlÄ± Analiz</div>
        <div class="chart-box">
          <canvas id="radar-canvas"></canvas>
        </div>
      </div>

      <!-- Description -->
      <div class="desc-card">
        <strong>Profil AÃ§Ä±klamasÄ±</strong>
        ${data.desc}
      </div>

      <!-- Suggestion -->
      <div class="desc-card">
        <strong>Ã–nerilen YaklaÅŸÄ±m</strong>
        ${data.suggestion}
      </div>

      <!-- Alloc -->
      <div class="chart-title" style="margin-bottom:8px">Ã–rnek PortfÃ¶y DaÄŸÄ±lÄ±mÄ±</div>
      <div class="alloc-row">${allocHTML}</div>

      <button class="btn-reset" onclick="resetAll()">Testi sÄ±fÄ±rla ve yeniden baÅŸla</button>
    </div>
  `, "anim-up");

  // Animate gauge
  requestAnimationFrame(() => requestAnimationFrame(() => {
    const fill = document.getElementById("g-fill");
    if (fill) fill.style.width = gaugePct + "%";
  }));

  // Draw radar chart
  setTimeout(() => {
    const canvas = document.getElementById("radar-canvas");
    if (!canvas) return;
    if (radarChart) radarChart.destroy();

    radarChart = new Chart(canvas, {
      type: "radar",
      data: {
        labels: SECTIONS.map(s => s.title),
        datasets: [{
          label: "Skorunuz",
          data: data.sectScores,
          fill: true,
          backgroundColor: hexToRgba(data.gradient[1], 0.18),
          borderColor: data.gradient[1],
          borderWidth: 2,
          pointBackgroundColor: data.gradient[1],
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: ctx => ` ${ctx.raw}%`
            }
          }
        },
        scales: {
          r: {
            min: 0,
            max: 100,
            ticks: {
              stepSize: 25,
              font: { size: 9 },
              color: "#a1a1aa",
              backdropColor: "transparent"
            },
            grid: { color: "#e4e4e7" },
            angleLines: { color: "#e4e4e7" },
            pointLabels: {
              font: { size: 10, family: "'Inter', sans-serif", weight: "600" },
              color: "#3f3f46"
            }
          }
        }
      }
    });
  }, 350);
}

function hexToRgba(hex, alpha) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function resetAll() {
  if (radarChart) { radarChart.destroy(); radarChart = null; }
  if (user) localStorage.removeItem("rp_result_" + user.email);
  ans = {}; cur = 0; user = null;
  progWrap.style.display = "";
  renderQ("right");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function init() {
  const savedUser = localStorage.getItem("rp_user");
  if (savedUser) {
    user = JSON.parse(savedUser);
    const saved = localStorage.getItem("rp_result_" + user.email);
    if (saved) { showResult(JSON.parse(saved)); return; }
  }
  renderQ("right");
})();
</script>
</body>
</html>
