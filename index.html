<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Risk Profili | YatÄ±rÄ±m AtlasÄ±</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}

:root{
  --blue:    #2563eb;
  --blue-s:  #eff4ff;
  --blue-d:  #1d4ed8;
  --ink:     #1a1f36;
  --ink2:    #4a5568;
  --muted:   #94a3b8;
  --border:  #e2e8f0;
  --bg-quiz: #f0f4fc;
  --bg-res:  #ffffff;
  --card:    #ffffff;
  --r:       14px;
  /* Kart boyutlarÄ± â€” responsive */
  --card-max:  520px;
  --card-h:    400px;   /* mobil kart yÃ¼ksekliÄŸi */
  --row-scale: 116px;
  --row-nav:   68px;
}

/* Desktop'ta kart daha bÃ¼yÃ¼k */
@media(min-width:640px){
  :root{
    --card-max:  620px;
    --card-h:    460px;
    --row-scale: 126px;
    --row-nav:   72px;
  }
}

/* â”€â”€ Sayfa scroll'unu quiz modunda kapat â”€â”€ */
html{
  height:100%;
  font-family:'Inter',sans-serif;
  color:var(--ink);
  -webkit-font-smoothing:antialiased;
}

/* QUIZ: viewport'u doldur, scroll yok */
html.quiz-html{ overflow:hidden; }
body.quiz{
  height:100%;
  overflow:hidden;
  background:var(--bg-quiz);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:14px 14px 16px;
  gap:10px;
}

/* RESULT: normal scroll */
html.result-html{ overflow:auto; }
body.result{
  background:var(--bg-quiz);
  min-height:100%;
  padding:20px 14px 36px;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:visible;
}

/* â•â•â•â•â•â•â•â• PROGRESS â•â•â•â•â•â•â•â• */
#prog{
  width:100%;
  max-width:var(--card-max);
  flex-shrink:0;
}
.pmeta{
  display:flex;
  justify-content:space-between;
  font-size:10.5px;
  font-weight:700;
  color:var(--muted);
  letter-spacing:.05em;
  text-transform:uppercase;
  margin-bottom:6px;
}
.ptrack{height:3px;background:var(--border);border-radius:99px;overflow:hidden;}
.pfill{
  height:100%;
  background:var(--blue);
  border-radius:99px;
  transition:width .45s cubic-bezier(.4,0,.2,1);
  width:3.3%;
}

/* â•â•â•â•â•â•â•â• QUIZ CARD â€” FIXED HEIGHT GRID â•â•â•â•â•â•â•â• */
#card{
  width:100%;
  max-width:var(--card-max);
  background:var(--card);
  border-radius:var(--r);
  box-shadow:0 2px 8px rgba(26,31,54,.07),0 8px 28px rgba(26,31,54,.09);
  overflow:hidden;
}

.qgrid{
  display:grid;
  grid-template-rows:1fr var(--row-scale) var(--row-nav);
  height:var(--card-h);
}

.qtop{
  padding:24px 24px 16px;
  border-bottom:1px solid var(--border);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.qcat{
  display:inline-flex;
  align-items:center;
  font-size:10px;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;
  color:var(--blue);background:var(--blue-s);
  padding:3px 10px;border-radius:99px;
  margin-bottom:12px;width:fit-content;
  flex-shrink:0;
}
.qtext{
  font-family:'Playfair Display',serif;
  font-size:clamp(16px,3.8vw,20px);
  font-weight:600;line-height:1.45;
  color:var(--ink);
  overflow:hidden;
  display:-webkit-box;
  -webkit-line-clamp:4;
  -webkit-box-orient:vertical;
}

.scalewrap{
  padding:14px 24px;
  border-bottom:1px solid var(--border);
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.scalehint{
  display:flex;justify-content:space-between;
  font-size:10.5px;color:var(--muted);font-weight:500;
  margin-bottom:10px;
}
.scalerow{display:flex;gap:8px;}
.scalerow button{
  flex:1;height:52px;
  border-radius:10px;
  border:1.5px solid var(--border);
  background:#fff;
  font-size:17px;font-weight:700;
  font-family:'Inter',sans-serif;
  color:var(--ink2);cursor:pointer;
  transition:all .12s ease;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.scalerow button:active{transform:scale(.92);}
.scalerow button.sel{
  background:var(--blue);color:#fff;
  border-color:var(--blue);
  box-shadow:0 3px 10px rgba(37,99,235,.3);
  transform:translateY(-1px);
}

.nav{
  display:flex;justify-content:space-between;align-items:center;
  padding:0 22px;height:var(--row-nav);
}
.btnback{
  font-size:14px;font-weight:500;color:var(--muted);
  background:none;border:none;cursor:pointer;
  padding:8px 4px;font-family:'Inter',sans-serif;
  transition:color .12s;
  -webkit-tap-highlight-color:transparent;
}
.btnback:hover{color:var(--ink);}
.btnback:disabled{opacity:.22;cursor:default;}
.btnnext{
  font-size:14px;font-weight:700;
  font-family:'Inter',sans-serif;
  color:#fff;background:var(--blue);
  border:none;border-radius:10px;
  padding:12px 24px;cursor:pointer;
  transition:all .12s;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}
.btnnext:active{transform:scale(.96);}

/* â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â• */
.loginwrap{padding:30px 28px 32px;}
.loginwrap h2{
  font-family:'Playfair Display',serif;
  font-size:clamp(20px,5vw,26px);font-weight:700;
  margin-bottom:6px;color:var(--ink);
}
.loginwrap p{
  font-size:13.5px;color:var(--muted);line-height:1.65;margin-bottom:24px;
}
.field{
  width:100%;padding:11px 13px;
  border:1.5px solid var(--border);border-radius:9px;
  font-size:13.5px;font-family:'Inter',sans-serif;
  color:var(--ink);background:#fff;outline:none;
  transition:border-color .12s;margin-bottom:9px;
  -webkit-appearance:none;
}
.field:focus{border-color:var(--blue);}
.btnsubmit{
  width:100%;padding:12px;
  background:var(--blue);color:#fff;border:none;border-radius:9px;
  font-size:13.5px;font-weight:700;font-family:'Inter',sans-serif;
  cursor:pointer;margin-top:3px;transition:all .12s;
  -webkit-tap-highlight-color:transparent;
}
.btnsubmit:active{transform:scale(.98);}

/* â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â• */
.rcard{
  width:100%;
  max-width:var(--card-max);
  margin:0 auto;
  background:var(--card);
  border-radius:var(--r);
  box-shadow:0 2px 8px rgba(26,31,54,.07),0 8px 28px rgba(26,31,54,.09);
  overflow:hidden;
}

/* Profile strip */
.rhead{
  padding:18px 20px 16px;
  display:flex;align-items:center;gap:13px;
  border-bottom:1px solid var(--border);
  background:var(--bg-quiz);
}
.rico{font-size:34px;line-height:1;flex-shrink:0;}
.rname{
  font-family:'Playfair Display',serif;
  font-size:clamp(18px,4.5vw,22px);font-weight:700;color:var(--ink);
}
.rlabel{
  font-size:10px;font-weight:700;letter-spacing:.1em;
  text-transform:uppercase;color:var(--muted);margin-bottom:1px;
}
.rscore{
  font-size:11px;color:var(--muted);margin-top:2px;
}

/* Sections */
.rsec{
  padding:14px 20px;
  border-bottom:1px solid var(--border);
}
.stitle{
  font-size:10px;font-weight:700;letter-spacing:.1em;
  text-transform:uppercase;color:var(--muted);margin-bottom:9px;
}

/* Gauge */
.glabels{
  display:flex;justify-content:space-between;
  font-size:10px;color:var(--muted);font-weight:500;margin-bottom:6px;
}
.gtrack{
  height:8px;background:var(--border);
  border-radius:99px;overflow:hidden;
}
.gfill{
  height:100%;border-radius:99px;width:0%;
  transition:width 1.1s cubic-bezier(.4,0,.2,1) .3s;
}
.zones{display:flex;gap:4px;margin-top:9px;}
.zone{
  flex:1;text-align:center;padding:5px 2px;
  border-radius:7px;font-size:9px;font-weight:700;
  letter-spacing:.02em;border:2px solid transparent;
}
.zone.z1{background:#dcfce7;color:#15803d;}
.zone.z2{background:#fef9c3;color:#92400e;}
.zone.z3{background:#dbeafe;color:#1d4ed8;}
.zone.z4{background:#fee2e2;color:#b91c1c;}
.zone.on{border-color:currentColor;}

/* Radar */
.chartbox{height:240px;position:relative;}
@media(min-width:640px){.chartbox{height:280px;}}

/* Desc */
.dcard{
  background:var(--bg-quiz);border-radius:9px;
  padding:12px 14px;font-size:13px;
  color:var(--ink2);line-height:1.65;margin-bottom:9px;
}
.dcard:last-child{margin-bottom:0;}
.dcard b{
  display:block;font-size:9.5px;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;
  color:var(--muted);margin-bottom:4px;
}

/* Alloc pills */
.allocs{display:flex;flex-wrap:wrap;gap:6px;}
.apill{
  display:flex;align-items:center;gap:6px;
  padding:5px 11px;border-radius:99px;
  font-size:11.5px;font-weight:600;
  border:1.5px solid var(--border);background:#fff;
}
.adot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}

/* Restart */
.rbtn{
  display:flex;align-items:center;justify-content:center;gap:7px;
  margin:14px 20px 20px;width:calc(100% - 40px);
  padding:12px;border-radius:9px;
  background:var(--bg-quiz);border:1.5px solid var(--border);
  font-size:13px;font-weight:600;font-family:'Inter',sans-serif;
  color:var(--ink2);cursor:pointer;transition:all .12s;
  -webkit-tap-highlight-color:transparent;
}
.rbtn:hover{background:var(--border);color:var(--ink);}
.rbtn:active{transform:scale(.98);}

/* â•â•â•â•â•â•â•â• ANIMATIONS â•â•â•â•â•â•â•â• */
@keyframes sR{from{opacity:0;transform:translateX(20px);}to{opacity:1;transform:translateX(0);}}
@keyframes sL{from{opacity:0;transform:translateX(-20px);}to{opacity:1;transform:translateX(0);}}
@keyframes fU{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}
@keyframes shk{0%,100%{transform:translateX(0);}25%{transform:translateX(-6px);}75%{transform:translateX(6px);}}
.aR{animation:sR .2s ease forwards;}
.aL{animation:sL .2s ease forwards;}
.aU{animation:fU .25s ease forwards;}
.shk{animation:shk .2s ease;}
</style>
</head>

<body class="quiz">
<div id="prog">
  <div class="pmeta">
    <span id="psec">Risk AlgÄ±sÄ±</span>
    <span id="pnum">1 / 30</span>
  </div>
  <div class="ptrack"><div class="pfill" id="pfill"></div></div>
</div>
<div id="card"></div>

<script>
/* â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â• */
const SEC=[
  {key:"risk",  title:"Risk AlgÄ±sÄ±",          short:"Risk",      color:"#6366f1", q:[
    "Piyasa %20 dÃ¼ÅŸtÃ¼ÄŸÃ¼nde pozisyonumu koruyabilirim.",
    "GeÃ§ici zararlar beni paniÄŸe sÃ¼rÃ¼klemez.",
    "DalgalÄ± piyasalarda sakin kalÄ±rÄ±m.",
    "PortfÃ¶y dÃ¼ÅŸÃ¼ÅŸlerinde stratejimi bozmam.",
    "Belirsizlik dÃ¶nemlerinde yatÄ±rÄ±m yapabilirim."
  ]},
  {key:"volat", title:"Volatilite ToleransÄ±", short:"Volatilite", color:"#8b5cf6", q:[
    "YÃ¼ksek getiri iÃ§in risk alabilirim.",
    "GÃ¼nlÃ¼k fiyat deÄŸiÅŸimleri beni rahatsÄ±z etmez.",
    "Agresif yatÄ±rÄ±m araÃ§larÄ±na aÃ§Ä±ÄŸÄ±m.",
    "KÄ±sa vadeli kayÄ±plarÄ± tolere edebilirim.",
    "OynaklÄ±k benim iÃ§in fÄ±rsattÄ±r."
  ]},
  {key:"zaman", title:"Zaman Ufku",           short:"Zaman",     color:"#3b82f6", q:[
    "YatÄ±rÄ±mlarÄ±mÄ± uzun vadeli planlarÄ±m.",
    "En az 5 yÄ±l yatÄ±rÄ±mda kalabilirim.",
    "SabÄ±rlÄ± bir yatÄ±rÄ±mcÄ±yÄ±m.",
    "KÄ±sa vadeli kazanÃ§ Ã¶nceliÄŸim deÄŸildir.",
    "Uzun sÃ¼re bekleyebilirim."
  ]},
  {key:"dayn",  title:"Finansal GÃ¼Ã§",         short:"Finansal",  color:"#10b981", q:[
    "Acil durum fonum mevcut.",
    "BorÃ§ oranÄ±m dÃ¼ÅŸÃ¼k.",
    "Gelirim dÃ¼zenli ve istikrarlÄ±.",
    "YatÄ±rÄ±m zararlarÄ± gÃ¼nlÃ¼k hayatÄ±mÄ± etkilemez.",
    "Nakit ihtiyacÄ±m dÃ¼ÅŸÃ¼k seviyede."
  ]},
  {key:"bilgi", title:"Bilgi & Deneyim",      short:"Bilgi",     color:"#f59e0b", q:[
    "YatÄ±rÄ±m piyasalarÄ± hakkÄ±nda bilgim var.",
    "Daha Ã¶nce yatÄ±rÄ±m deneyimim oldu.",
    "Risk-getiri iliÅŸkisini iyi bilirim.",
    "FarklÄ± varlÄ±k tÃ¼rlerini tanÄ±rÄ±m.",
    "Piyasa analizlerini dÃ¼zenli takip ederim."
  ]},
  {key:"davr",  title:"DavranÄ±ÅŸsal Disiplin", short:"Disiplin",  color:"#ef4444", q:[
    "Piyasa dÃ¼ÅŸÃ¼ÅŸlerinde panik satÄ±ÅŸ yapmam.",
    "SÃ¼rÃ¼ psikolojisinden etkilenmem.",
    "BelirlediÄŸim stratejiye sadÄ±k kalÄ±rÄ±m.",
    "DuygularÄ±mÄ± yatÄ±rÄ±m kararlarÄ±ndan ayÄ±rÄ±rÄ±m.",
    "AÅŸÄ±rÄ± Ã¶zgÃ¼venle karar vermekten kaÃ§Ä±nÄ±rÄ±m."
  ]}
];

const AQ=[];
SEC.forEach((s,si)=>s.q.forEach((q,qi)=>AQ.push({s,si,qi,q})));
const TOT=AQ.length;

const PROF=[
  {min:30, max:74,  name:"Koruma OdaklÄ±", icon:"ğŸ›¡ï¸", zone:0,
   grad:["#bbf7d0","#22c55e"], color:"#15803d",
   desc:"Sermayenizi korumayÄ± Ã¶n planda tutuyorsunuz. GÃ¼venli, istikrarlÄ± varlÄ±klara yÃ¶neliyorsunuz.",
   sug:"Devlet tahvili, mevduat, altÄ±n ve dÃ¼ÅŸÃ¼k volatiliteli fonlar portfÃ¶yÃ¼nÃ¼zÃ¼n temelini oluÅŸturabilir.",
   al:[{l:"Tahvil/Mevduat",p:"50%",c:"#4ade80"},{l:"AltÄ±n",p:"25%",c:"#fbbf24"},{l:"Hisse",p:"15%",c:"#60a5fa"},{l:"DiÄŸer",p:"10%",c:"#a78bfa"}]},
  {min:75, max:104, name:"Dengeli",       icon:"âš–ï¸", zone:1,
   grad:["#fef08a","#f59e0b"], color:"#92400e",
   desc:"Risk ve getiriyi dengelemeyi tercih ediyorsunuz. Makul getiri iÃ§in sÄ±nÄ±rlÄ± dÃ¼ÅŸÃ¼ÅŸleri kaldÄ±rabilirsiniz.",
   sug:"Karma portfÃ¶y, temettÃ¼ hisseleri ve orta vadeli tahvil kombinasyonu size uygundur.",
   al:[{l:"Hisse",p:"40%",c:"#60a5fa"},{l:"Tahvil",p:"35%",c:"#4ade80"},{l:"AltÄ±n",p:"15%",c:"#fbbf24"},{l:"DiÄŸer",p:"10%",c:"#a78bfa"}]},
  {min:105,max:134, name:"BÃ¼yÃ¼me OdaklÄ±",icon:"ğŸ“ˆ", zone:2,
   grad:["#bfdbfe","#3b82f6"], color:"#1d4ed8",
   desc:"Uzun vadeli bÃ¼yÃ¼me iÃ§in geÃ§ici dalgalanmalarÄ± kaldÄ±rabiliyorsunuz. BilinÃ§li ve disiplinli risk alÄ±yorsunuz.",
   sug:"Hisse aÄŸÄ±rlÄ±klÄ±, Ã§eÅŸitlendirilmiÅŸ portfÃ¶y. BÃ¼yÃ¼me hisseleri ve geliÅŸmekte olan piyasalar radarÄ±nÄ±zda.",
   al:[{l:"Hisse",p:"60%",c:"#60a5fa"},{l:"Tahvil",p:"20%",c:"#4ade80"},{l:"AltÄ±n",p:"10%",c:"#fbbf24"},{l:"Kripto/DiÄŸer",p:"10%",c:"#a78bfa"}]},
  {min:135,max:150, name:"Agresif",       icon:"ğŸš€", zone:3,
   grad:["#fecaca","#ef4444"], color:"#b91c1c",
   desc:"YÃ¼ksek getiri iÃ§in yÃ¼ksek riski gÃ¶ze alabiliyorsunuz. Volatiliteyi fÄ±rsat olarak gÃ¶rÃ¼yorsunuz.",
   sug:"YÃ¼ksek bÃ¼yÃ¼me potansiyelli hisseler, kripto para ve alternatif yatÄ±rÄ±m araÃ§larÄ± profilinize uygun.",
   al:[{l:"Hisse",p:"70%",c:"#60a5fa"},{l:"Kripto",p:"15%",c:"#a78bfa"},{l:"Tahvil",p:"10%",c:"#4ade80"},{l:"DiÄŸer",p:"5%",c:"#fbbf24"}]}
];

/* â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â• */
let cur=0, ans={}, user=null, rChart=null;

const body=document.body;
const card=document.getElementById("card");
const prog=document.getElementById("prog");
const pfill=document.getElementById("pfill");
const psec=document.getElementById("psec");
const pnum=document.getElementById("pnum");

/* â•â•â•â•â•â•â•â• IFRAME RESIZE â•â•â•â•â•â•â•â• */
function notifyHeight(){
  try{
    // Quiz modunda kart yÃ¼ksekliÄŸi sabittir, result'ta dinamik
    const h = body.classList.contains("result")
      ? Math.max(document.documentElement.scrollHeight, document.body.scrollHeight)
      : document.body.offsetHeight;
    window.parent.postMessage({type:"iframeResize",height:h+8},"*");
  }catch(e){}
}

/* â•â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•â• */
function upProg(){
  const pct=((cur+1)/TOT)*100;
  pfill.style.width=Math.max(pct,3.3)+"%";
  psec.textContent=AQ[Math.min(cur,TOT-1)].s.title;
  pnum.textContent=(cur+1)+" / "+TOT;
}

function anim(el,cls){
  el.classList.remove("aR","aL","aU","shk");
  void el.offsetWidth;
  if(cls) el.classList.add(cls);
}

function quizMode(){
  document.documentElement.className="quiz-html";
  body.className="quiz";
  prog.style.display="flex";
  setTimeout(notifyHeight,50);
}

function resultMode(){
  document.documentElement.className="result-html";
  body.className="result";
  prog.style.display="none";
  setTimeout(notifyHeight,400);
}

/* â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â• */
function renderQ(dir){
  upProg();
  quizMode();
  const item=AQ[cur];
  const sel=ans[cur];
  const last=cur===TOT-1;
  card.innerHTML=`
    <div class="qgrid">
      <div class="qtop">
        <div class="qcat">${item.s.title}</div>
        <div class="qtext">${item.q}</div>
      </div>
      <div class="scalewrap">
        <div class="scalehint"><span>1 â€” HiÃ§ rahat deÄŸilim</span><span>5 â€” Ã‡ok rahatÄ±m</span></div>
        <div class="scalerow">
          ${[1,2,3,4,5].map(v=>`<button class="${sel===v?"sel":""}" onclick="pick(${v})">${v}</button>`).join("")}
        </div>
      </div>
      <div class="nav">
        <button class="btnback" onclick="back()" ${cur===0?"disabled":""}>â† Geri</button>
        <button class="btnnext" onclick="next()">${last?"Sonucu GÃ¶r âœ¦":"Ä°leri â†’"}</button>
      </div>
    </div>`;
  anim(card,dir==="R"?"aR":dir==="L"?"aL":null);
}

function pick(v){
  ans[cur]=v;
  document.querySelectorAll(".scalerow button").forEach((b,i)=>{
    b.className=(i+1===v)?"sel":"";
  });
}

function next(){
  if(!ans[cur]){anim(card,"shk");return;}
  if(cur<TOT-1){cur++;renderQ("R");}
  else showLogin();
}

function back(){
  if(cur>0){cur--;renderQ("L");}
}

/* â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â• */
function showLogin(){
  quizMode();
  prog.style.display="none";
  card.innerHTML=`
    <div class="loginwrap">
      <h2>Son bir adÄ±m.</h2>
      <p>Sonucunuzu gÃ¶rmek iÃ§in bilgilerinizi girin.</p>
      <input class="field" id="fn" type="text"  placeholder="Ad Soyad"       autocomplete="name"/>
      <input class="field" id="fe" type="email" placeholder="E-posta adresi" autocomplete="email"/>
      <button class="btnsubmit" onclick="doLogin()">Sonucumu GÃ¶r â†’</button>
    </div>`;
  anim(card,"aR");
  setTimeout(()=>{const e=document.getElementById("fn");if(e)e.focus();},300);
}

function doLogin(){
  const n=(document.getElementById("fn").value||"").trim();
  const e=(document.getElementById("fe").value||"").trim();
  if(!n||!e||!e.includes("@")){
    const b=document.querySelector(".btnsubmit");
    b.style.background="#ef4444";b.textContent="Bilgileri eksiksiz doldurun";
    setTimeout(()=>{b.style.background="";b.textContent="Sonucumu GÃ¶r â†’";},1500);
    return;
  }
  user={name:n,email:e};
  localStorage.setItem("rp_u",JSON.stringify(user));
  const sv=localStorage.getItem("rp_r_"+e);
  if(sv) showResult(JSON.parse(sv));
  else compute();
}

/* â•â•â•â•â•â•â•â• COMPUTE â•â•â•â•â•â•â•â• */
function compute(){
  const total=Object.values(ans).reduce((a,b)=>a+b,0);
  const ss=SEC.map((_,si)=>{
    let s=0;for(let q=0;q<5;q++)s+=(ans[si*5+q]||1);
    return Math.round((s/25)*100);
  });
  const p=PROF.find(x=>total>=x.min&&total<=x.max)||PROF[PROF.length-1];
  const d={name:user.name,email:user.email,total,ss,
    name2:p.name,icon:p.icon,desc:p.desc,sug:p.sug,
    al:p.al,color:p.color,grad:p.grad,zone:p.zone,
    date:new Date().toISOString()};
  localStorage.setItem("rp_r_"+user.email,JSON.stringify(d));
  showResult(d);
}

/* â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â• */
function showResult(d){
  resultMode();
  const pct=Math.round(((d.total-30)/120)*100);
  const zones=["Koruma","Dengeli","BÃ¼yÃ¼me","Agresif"];

  card.className="rcard";
  card.innerHTML=`
    <div class="rhead">
      <div class="rico">${d.icon}</div>
      <div>
        <div class="rlabel">Risk Profiliniz</div>
        <div class="rname">${d.name2}</div>
        <div class="rscore">Skor: ${d.total} / 150 Â· ${d.name}</div>
      </div>
    </div>

    <div class="rsec">
      <div class="stitle">Risk Seviyesi</div>
      <div class="glabels"><span>DÃ¼ÅŸÃ¼k Risk</span><span>YÃ¼ksek Risk</span></div>
      <div class="gtrack">
        <div class="gfill" id="gf"
          style="background:linear-gradient(90deg,${d.grad[0]},${d.grad[1]})"></div>
      </div>
      <div class="zones">
        ${zones.map((z,i)=>`<div class="zone z${i+1}${i===d.zone?" on":""}">${z}</div>`).join("")}
      </div>
    </div>

    <div class="rsec">
      <div class="stitle">Kategori BazlÄ± Analiz</div>
      <div class="chartbox"><canvas id="rcv"></canvas></div>
    </div>

    <div class="rsec">
      <div class="dcard"><b>Profil AÃ§Ä±klamasÄ±</b>${d.desc}</div>
      <div class="dcard"><b>Ã–nerilen YaklaÅŸÄ±m</b>${d.sug}</div>
    </div>

    <div class="rsec">
      <div class="stitle" style="margin-bottom:9px">Ã–rnek PortfÃ¶y DaÄŸÄ±lÄ±mÄ±</div>
      <div class="allocs">
        ${(d.al||[]).map(a=>`<div class="apill">
          <div class="adot" style="background:${a.c}"></div>
          <span>${a.l} <strong>${a.p}</strong></span>
        </div>`).join("")}
      </div>
    </div>

    <button class="rbtn" onclick="reset()">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor"
           stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="1 4 1 10 7 10"/>
        <path d="M3.51 15a9 9 0 1 0 .49-4"/>
      </svg>
      Testi Yeniden BaÅŸlat
    </button>
  `;

  anim(card,"aU");

  /* Gauge animasyonu */
  requestAnimationFrame(()=>requestAnimationFrame(()=>{
    const f=document.getElementById("gf");
    if(f) f.style.width=pct+"%";
  }));

  /* Radar chart */
  setTimeout(()=>{
    const cv=document.getElementById("rcv");
    if(!cv) return;
    if(rChart){rChart.destroy();rChart=null;}
    rChart=new Chart(cv,{
      type:"radar",
      data:{
        labels:SEC.map(s=>s.short),
        datasets:[{
          label:"Skorunuz",
          data:d.ss,
          fill:true,
          backgroundColor:ha(d.grad[1],.14),
          borderColor:d.grad[1],
          borderWidth:2,
          pointBackgroundColor:d.grad[1],
          pointRadius:4,
          pointHoverRadius:6
        }]
      },
      options:{
        responsive:true,maintainAspectRatio:false,
        layout:{padding:{top:8,bottom:8,left:12,right:12}},
        plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>` ${c.raw}%`}}},
        scales:{r:{
          min:0,max:100,
          ticks:{stepSize:25,font:{size:9},color:"#94a3b8",backdropColor:"transparent"},
          grid:{color:"#e2e8f0"},angleLines:{color:"#e2e8f0"},
          pointLabels:{
            font:{size:10.5,family:"'Inter',sans-serif",weight:"600"},
            color:"#4a5568",padding:10
          }
        }}
      }
    });
    setTimeout(notifyHeight,200);
  },350);
}

function ha(hex,a){
  const r=parseInt(hex.slice(1,3),16);
  const g=parseInt(hex.slice(3,5),16);
  const b=parseInt(hex.slice(5,7),16);
  return`rgba(${r},${g},${b},${a})`;
}

function reset(){
  if(rChart){rChart.destroy();rChart=null;}
  if(user) localStorage.removeItem("rp_r_"+user.email);
  card.className="";
  ans={};cur=0;user=null;
  renderQ("R");
}

/* â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â• */
(function(){
  const su=localStorage.getItem("rp_u");
  if(su){
    user=JSON.parse(su);
    const sr=localStorage.getItem("rp_r_"+user.email);
    if(sr){showResult(JSON.parse(sr));return;}
  }
  renderQ(null);
})();
</script>
</body>
</html>
