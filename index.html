<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Risk Profili Analizi | Yatƒ±rƒ±m Atlasƒ±</title>

<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  üî• FIREBASE KURULUMU
  1. https://console.firebase.google.com ‚Üí Yeni proje olu≈ütur
  2. Project Settings > "Web uygulamasƒ± ekle" (</> ikonu)
  3. A≈üaƒüƒ±daki firebaseConfig'i kendi deƒüerlerinizle doldurun
  4. Authentication > Sign-in method:
     ‚Üí "Email/Password" aktif et
     ‚Üí "Google" aktif et (yatirimatlas.com domain'i ekle)
  5. Authorized domains'e GitHub Pages URL'nizi ekleyin:
     yatirimatlas.github.io
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getAuth, onAuthStateChanged,
    GoogleAuthProvider, signInWithPopup,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    updateProfile, signOut
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  /* ‚îÄ‚îÄ üîß BURAYA KENDƒ∞ FIREBASE Bƒ∞LGƒ∞LERƒ∞Nƒ∞Zƒ∞ Gƒ∞Rƒ∞N ‚îÄ‚îÄ */
  const firebaseConfig = {
    apiKey:            "YOUR_API_KEY",
    authDomain:        "YOUR_PROJECT.firebaseapp.com",
    projectId:         "YOUR_PROJECT_ID",
    storageBucket:     "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId:             "YOUR_APP_ID"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const googleProvider = new GoogleAuthProvider();

  /* Globale a√ß ‚Äî quiz mantƒ±ƒüƒ± bunlarƒ± kullanƒ±r */
  window._fb = { auth, googleProvider,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    GoogleAuthProvider, signInWithPopup,
    updateProfile, signOut, onAuthStateChanged };

  /* Kullanƒ±cƒ± oturumunu izle */
  onAuthStateChanged(auth, (user) => {
    if (user) {
      window._fbUser = user;
      if (window._onAuthReady) window._onAuthReady(user);
    } else {
      window._fbUser = null;
    }
  });
</script>

<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:          #f0ede8;
  --card:        #ffffff;
  --ink:         #1a1814;
  --muted:       #8a857e;
  --border:      #e2ddd8;
  --accent:      #2563eb;
  --accent-soft: #eff4ff;
  --green:       #16a34a;
  --green-soft:  #f0fdf4;
  --red:         #dc2626;
  --red-soft:    #fef2f2;
  --fb-blue:     #1877f2;
  --radius:      20px;
}

html, body {
  height: 100%;
  background: var(--bg);
  font-family: 'DM Sans', sans-serif;
  color: var(--ink);
  overflow: hidden;
}

.shell {
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.card {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: 0 4px 40px rgba(0,0,0,.08), 0 1px 4px rgba(0,0,0,.04);
  width: 100%;
  max-width: 560px;
  overflow: hidden;
}

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
.progress-wrap {
  width: 100%;
  max-width: 560px;
  margin-bottom: 14px;
}
.progress-meta {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 7px;
  font-weight: 500;
}
.progress-track {
  height: 3px;
  background: var(--border);
  border-radius: 99px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: var(--ink);
  border-radius: 99px;
  transition: width .4s cubic-bezier(.4,0,.2,1);
}

/* ‚îÄ‚îÄ QUESTION ‚îÄ‚îÄ */
.q-header {
  padding: 28px 32px 20px;
  border-bottom: 1px solid var(--border);
}
.q-category {
  display: inline-block;
  font-size: 11px; font-weight: 600; letter-spacing: .1em;
  text-transform: uppercase; color: var(--accent);
  background: var(--accent-soft); padding: 4px 10px;
  border-radius: 99px; margin-bottom: 14px;
}
.q-text {
  font-family: 'DM Serif Display', serif;
  font-size: 22px; line-height: 1.35; min-height: 62px;
}

/* ‚îÄ‚îÄ SCALE ‚îÄ‚îÄ */
.scale-wrap { padding: 24px 32px 28px; }
.scale-labels {
  display: flex; justify-content: space-between;
  font-size: 11px; color: var(--muted); font-weight: 500; margin-bottom: 14px;
}
.scale-btns { display: flex; gap: 8px; }
.scale-btns button {
  flex: 1; aspect-ratio: 1; border-radius: 14px;
  border: 1.5px solid var(--border); background: white;
  font-size: 16px; font-weight: 600; font-family: 'DM Sans', sans-serif;
  cursor: pointer; color: var(--ink); transition: all .18s ease;
}
.scale-btns button:hover {
  border-color: var(--ink); background: #fafaf8;
  transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,.08);
}
.scale-btns button.active {
  background: var(--ink); color: white; border-color: var(--ink);
  transform: translateY(-2px); box-shadow: 0 4px 16px rgba(26,24,20,.25);
}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
.nav {
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 32px 20px; border-top: 1px solid var(--border);
}
.btn-back {
  font-size: 13px; font-weight: 500; color: var(--muted);
  background: none; border: none; cursor: pointer; padding: 8px 0;
  transition: color .15s;
}
.btn-back:hover { color: var(--ink); }
.btn-back:disabled { opacity: .3; cursor: default; }
.btn-next {
  font-size: 14px; font-weight: 600;
  font-family: 'DM Sans', sans-serif; color: white;
  background: var(--ink); border: none; border-radius: 12px;
  padding: 11px 24px; cursor: pointer; transition: all .18s ease;
}
.btn-next:hover { background: #3a3530; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(0,0,0,.2); }

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
.slide-out-left  { animation: soL .20s ease forwards; }
.slide-in-right  { animation: siR .20s ease forwards; }
.slide-out-right { animation: soR .20s ease forwards; }
.slide-in-left   { animation: siL .20s ease forwards; }
@keyframes soL { to   { opacity:0; transform:translateX(-32px); } }
@keyframes siR { from { opacity:0; transform:translateX(32px);  } to { opacity:1; transform:translateX(0); } }
@keyframes soR { to   { opacity:0; transform:translateX(32px);  } }
@keyframes siL { from { opacity:0; transform:translateX(-32px); } to { opacity:1; transform:translateX(0); } }
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

/* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
.auth-wrap {
  padding: 44px 40px 40px;
  animation: fadeIn .3s ease;
}

.auth-wrap h1 {
  font-family: 'DM Serif Display', serif;
  font-size: 32px; font-weight: 400;
  text-align: center; margin-bottom: 10px;
}

.auth-subtitle {
  text-align: center;
  font-size: 14px; color: var(--muted);
  margin-bottom: 28px;
}
.auth-subtitle a {
  color: var(--accent); font-weight: 500;
  text-decoration: none; cursor: pointer;
}
.auth-subtitle a:hover { text-decoration: underline; }

/* Social buttons */
.btn-google, .btn-facebook {
  width: 100%; padding: 13px 18px;
  border-radius: 10px; border: 1.5px solid var(--border);
  font-size: 14px; font-weight: 500;
  font-family: 'DM Sans', sans-serif;
  cursor: pointer; display: flex; align-items: center;
  justify-content: center; gap: 10px; transition: all .18s;
  margin-bottom: 10px;
}
.btn-google {
  background: white; color: var(--ink);
}
.btn-google:hover { background: #f8f8f8; border-color: #ccc; box-shadow: 0 2px 8px rgba(0,0,0,.08); }

.btn-facebook {
  background: var(--fb-blue); color: white; border-color: var(--fb-blue);
}
.btn-facebook:hover { background: #166fe5; border-color: #166fe5; box-shadow: 0 2px 8px rgba(24,119,242,.3); }

/* Divider */
.auth-divider {
  display: flex; align-items: center; gap: 12px;
  margin: 18px 0; color: var(--muted); font-size: 13px;
}
.auth-divider::before, .auth-divider::after {
  content: ""; flex: 1; height: 1px; background: var(--border);
}

/* Email form */
.auth-form input {
  width: 100%; padding: 12px 15px;
  border: 1.5px solid var(--border); border-radius: 10px;
  font-size: 14px; font-family: 'DM Sans', sans-serif;
  color: var(--ink); background: white; margin-bottom: 10px;
  outline: none; transition: border-color .15s;
}
.auth-form input:focus { border-color: var(--ink); }

.auth-error {
  font-size: 12px; color: var(--red); background: var(--red-soft);
  border-radius: 8px; padding: 8px 12px; margin-bottom: 12px;
  display: none; line-height: 1.5;
}
.auth-error.show { display: block; }

.btn-email-submit {
  width: 100%; padding: 13px;
  background: white; color: var(--ink);
  border: 1.5px solid var(--border); border-radius: 10px;
  font-size: 14px; font-weight: 500;
  font-family: 'DM Sans', sans-serif; cursor: pointer;
  transition: all .18s; display: flex; align-items: center; justify-content: center; gap: 8px;
}
.btn-email-submit:hover { border-color: var(--ink); background: #fafaf8; }

/* Inline email form (expanded) */
.email-expanded {
  margin-top: 14px;
  border-top: 1px solid var(--border);
  padding-top: 18px;
  animation: fadeIn .25s ease;
}
.email-expanded .btn-submit-main {
  width: 100%; padding: 13px;
  background: var(--ink); color: white;
  border: none; border-radius: 10px;
  font-size: 14px; font-weight: 600;
  font-family: 'DM Sans', sans-serif;
  cursor: pointer; margin-top: 4px; transition: all .18s;
}
.email-expanded .btn-submit-main:hover { background: #3a3530; transform: translateY(-1px); }
.email-expanded .btn-submit-main:disabled { opacity:.6; cursor:default; transform:none; }

/* Privacy note */
.auth-note {
  font-size: 12px; color: var(--muted); text-align: center;
  line-height: 1.6; margin-top: 20px; padding-top: 20px;
  border-top: 1px solid var(--border);
}

/* ‚îÄ‚îÄ USER BAR (logged in) ‚îÄ‚îÄ */
.user-bar {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 20px; background: #fafaf8;
  border-bottom: 1px solid var(--border);
}
.user-avatar {
  width: 30px; height: 30px; border-radius: 50%;
  background: var(--ink); color: white;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 600; overflow: hidden; flex-shrink: 0;
}
.user-avatar img { width: 100%; height: 100%; object-fit: cover; }
.user-name { font-size: 13px; font-weight: 500; flex: 1; }
.btn-signout {
  font-size: 11px; color: var(--muted); background: none; border: none;
  cursor: pointer; font-family: 'DM Sans', sans-serif;
  text-decoration: underline; text-underline-offset: 2px;
}
.btn-signout:hover { color: var(--red); }

/* ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ */
.result-body { padding: 34px 34px 28px; text-align: center; }
.result-icon {
  width: 58px; height: 58px; border-radius: 50%;
  background: var(--ink); color: white;
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 18px; font-size: 23px;
}
.result-label {
  font-size: 11px; font-weight: 600; letter-spacing: .14em;
  text-transform: uppercase; color: var(--muted); margin-bottom: 6px;
}
.result-profile {
  font-family: 'DM Serif Display', serif;
  font-size: 30px; color: var(--ink); margin-bottom: 9px;
}
.result-score {
  display: inline-block; font-size: 12px; color: var(--muted);
  background: var(--bg); padding: 4px 12px; border-radius: 99px; margin-bottom: 20px;
}
.score-bar-wrap {
  background: var(--bg); border-radius: 12px;
  padding: 13px 16px; margin-bottom: 18px; text-align: left;
}
.score-bar-labels {
  display: flex; justify-content: space-between;
  font-size: 10px; color: var(--muted); font-weight: 600;
  letter-spacing: .06em; text-transform: uppercase; margin-bottom: 8px;
}
.score-bar-track { height: 6px; background: var(--border); border-radius: 99px; overflow: hidden; }
.score-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, #60a5fa, #1d4ed8);
  border-radius: 99px;
  transition: width 1s cubic-bezier(.4,0,.2,1) .35s;
}
.result-desc {
  font-size: 13px; color: var(--muted); line-height: 1.7;
  margin-bottom: 22px; max-width: 380px; margin-left: auto; margin-right: auto;
}
.btn-email-result {
  width: 100%; padding: 12px;
  background: var(--green-soft); color: var(--green);
  border: 1.5px solid #bbf7d0; border-radius: 12px;
  font-size: 13px; font-weight: 600; font-family: 'DM Sans', sans-serif;
  cursor: pointer; transition: all .18s;
  display: flex; align-items: center; justify-content: center; gap: 7px;
  margin-bottom: 10px;
}
.btn-email-result:hover { background: #dcfce7; transform: translateY(-1px); }
.btn-email-result:disabled { opacity:.6; cursor:default; transform:none; }
.email-status {
  font-size: 12px; padding: 8px 12px; border-radius: 8px;
  text-align: center; display: none; margin-bottom: 10px;
}
.email-status.success { background: var(--green-soft); color: var(--green); display: block; }
.email-status.error   { background: var(--red-soft);   color: var(--red);   display: block; }
.btn-reset {
  font-size: 12px; color: var(--muted); background: none; border: none;
  cursor: pointer; text-decoration: underline; text-underline-offset: 3px;
  font-family: 'DM Sans', sans-serif;
}
.btn-reset:hover { color: var(--ink); }
</style>
</head>
<body>

<div class="shell">
  <div class="progress-wrap" id="progress-wrap">
    <div class="progress-meta">
      <span id="prog-label">Risk Algƒ±sƒ±</span>
      <span id="prog-count">1 / 30</span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="prog-fill" style="width:3.3%"></div>
    </div>
  </div>
  <div class="card" id="card"></div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EmailJS (opsiyonel ‚Äî e-posta i√ßin)
   YOUR_PUBLIC_KEY yerine kendi key'inizi yazƒ±n
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const EMAILJS_PUBLIC_KEY  = "YOUR_PUBLIC_KEY";
const EMAILJS_SERVICE_ID  = "YOUR_SERVICE_ID";
const EMAILJS_TEMPLATE_ID = "YOUR_TEMPLATE_ID";

/* ‚îÄ‚îÄ DATA ‚îÄ‚îÄ */
const sections = [
  { title: "Risk Algƒ±sƒ±", questions: [
    "Piyasa %20 d√º≈üt√ºƒü√ºnde pozisyonumu koruyabilirim.",
    "Ge√ßici zararlar beni paniƒüe s√ºr√ºklemez.",
    "Dalgalƒ± piyasalarda sakin kalƒ±rƒ±m.",
    "Portf√∂y d√º≈ü√º≈ülerinde stratejimi bozmam.",
    "Belirsizlik d√∂nemlerinde yatƒ±rƒ±m yapabilirim."
  ]},
  { title: "Volatilite Toleransƒ±", questions: [
    "Y√ºksek getiri i√ßin risk alabilirim.",
    "G√ºnl√ºk fiyat deƒüi≈üimleri beni rahatsƒ±z etmez.",
    "Agresif yatƒ±rƒ±m ara√ßlarƒ±na a√ßƒ±ƒüƒ±m.",
    "Kƒ±sa vadeli kayƒ±plarƒ± tolere edebilirim.",
    "Oynaklƒ±k fƒ±rsat yaratƒ±r."
  ]},
  { title: "Zaman Ufku", questions: [
    "Yatƒ±rƒ±mlarƒ±mƒ± uzun vadeli planlarƒ±m.",
    "En az 5 yƒ±l yatƒ±rƒ±mda kalabilirim.",
    "Sabƒ±rlƒ± bir yatƒ±rƒ±mcƒ±yƒ±m.",
    "Kƒ±sa vadeli kazan√ß √∂nceliƒüim deƒüildir.",
    "Uzun s√ºre bekleyebilirim."
  ]},
  { title: "Finansal Dayanƒ±klƒ±lƒ±k", questions: [
    "Acil durum fonum var.",
    "Bor√ß oranƒ±m d√º≈ü√ºk.",
    "Gelirim d√ºzenli.",
    "Yatƒ±rƒ±m zararlarƒ± hayatƒ±mƒ± etkilemez.",
    "Nakit ihtiyacƒ±m d√º≈ü√ºk."
  ]},
  { title: "Bilgi ve Deneyim", questions: [
    "Piyasa bilgim var.",
    "Daha √∂nce yatƒ±rƒ±m yaptƒ±m.",
    "Risk-getiri ili≈ükisini bilirim.",
    "Farklƒ± varlƒ±k t√ºrlerini tanƒ±rƒ±m.",
    "Piyasa analizlerini takip ederim."
  ]},
  { title: "Davranƒ±≈üsal Disiplin", questions: [
    "Panik satƒ±≈ü yapmam.",
    "S√ºr√º psikolojisinden etkilenmem.",
    "Stratejime sadƒ±k kalƒ±rƒ±m.",
    "Duygularƒ±mƒ± kontrol ederim.",
    "A≈üƒ±rƒ± √∂zg√ºvenli karar almam."
  ]}
];

const allQuestions = [];
sections.forEach((sec) => {
  sec.questions.forEach((q) => allQuestions.push({ section: sec.title, text: q }));
});
const TOTAL = allQuestions.length;

const profiles = [
  { min:30,  max:75,  name:"Koruma Odaklƒ±", icon:"üõ°Ô∏è", desc:"Sermayeyi korumayƒ± √∂nceliklendirirsiniz. Tahvil, altƒ±n ve mevduat gibi d√º≈ü√ºk riskli ara√ßlar size uygundur." },
  { min:76,  max:110, name:"Dengeli",        icon:"‚öñÔ∏è", desc:"Risk ve getiriyi dengede tutarsƒ±nƒ±z. Karma portf√∂yler ve temett√º hisseleri profilinize yakƒ±≈üƒ±r." },
  { min:111, max:150, name:"B√ºy√ºme Odaklƒ±",  icon:"üìà", desc:"Uzun vadeli b√ºy√ºme i√ßin makul risk alƒ±rsƒ±nƒ±z. Hisse aƒüƒ±rlƒ±klƒ±, √ße≈üitlendirilmi≈ü portf√∂yler uygundur." },
  { min:151, max:180, name:"Agresif",        icon:"üöÄ", desc:"Y√ºksek getiri i√ßin y√ºksek riski g√∂ze alƒ±rsƒ±nƒ±z. Kripto, kaldƒ±ra√ßlƒ± ara√ßlar ve b√ºy√ºme hisseleri radarƒ±nƒ±zda." }
];

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let current = 0;
let answers = {};
let emailExpanded = false;

const card     = document.getElementById("card");
const progFill = document.getElementById("prog-fill");
const progLabel= document.getElementById("prog-label");
const progCount= document.getElementById("prog-count");
const progWrap = document.getElementById("progress-wrap");

/* ‚îÄ‚îÄ SLIDE ‚îÄ‚îÄ */
function setContent(html, direction = "right") {
  const out = direction === "right" ? "slide-out-left"  : "slide-out-right";
  const inn = direction === "right" ? "slide-in-right"  : "slide-in-left";
  card.classList.add(out);
  setTimeout(() => {
    card.innerHTML = html;
    card.classList.remove(out);
    card.classList.add(inn);
    setTimeout(() => card.classList.remove(inn), 260);
  }, 185);
}

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
function updateProgress() {
  const pct = ((current + 1) / TOTAL) * 100;
  progFill.style.width = Math.max(pct, 3.3) + "%";
  progLabel.textContent = allQuestions[Math.min(current, TOTAL-1)].section;
  progCount.textContent = (current+1) + " / " + TOTAL;
}

/* ‚îÄ‚îÄ QUESTION ‚îÄ‚îÄ */
function renderQuestion(dir = "right") {
  updateProgress();
  progWrap.style.display = "";
  const q = allQuestions[current];
  const sel = answers[current];
  const isLast  = current === TOTAL - 1;
  const isFirst = current === 0;

  const btns = [1,2,3,4,5].map(v =>
    `<button class="${sel===v?'active':''}" onclick="pick(${v})">${v}</button>`
  ).join("");

  setContent(`
    <div class="q-header">
      <div class="q-category">${q.section}</div>
      <div class="q-text">${q.text}</div>
    </div>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Hi√ß rahat deƒüilim</span><span>Son derece rahatƒ±m</span></div>
      <div class="scale-btns">${btns}</div>
    </div>
    <div class="nav">
      <button class="btn-back" onclick="goBack()" ${isFirst?"disabled":""}>‚Üê Geri</button>
      <button class="btn-next" onclick="goNext()">${isLast?"Sonucu G√∂r ‚Üí":"ƒ∞leri ‚Üí"}</button>
    </div>
  `, dir);
}

function pick(v) {
  answers[current] = v;
  const q = allQuestions[current];
  const isLast  = current === TOTAL - 1;
  const isFirst = current === 0;
  const btns = [1,2,3,4,5].map(val =>
    `<button class="${v===val?'active':''}" onclick="pick(${val})">${val}</button>`
  ).join("");
  card.innerHTML = `
    <div class="q-header">
      <div class="q-category">${q.section}</div>
      <div class="q-text">${q.text}</div>
    </div>
    <div class="scale-wrap">
      <div class="scale-labels"><span>Hi√ß rahat deƒüilim</span><span>Son derece rahatƒ±m</span></div>
      <div class="scale-btns">${btns}</div>
    </div>
    <div class="nav">
      <button class="btn-back" onclick="goBack()" ${isFirst?"disabled":""}>‚Üê Geri</button>
      <button class="btn-next" onclick="goNext()">${isLast?"Sonucu G√∂r ‚Üí":"ƒ∞leri ‚Üí"}</button>
    </div>
  `;
}

function goNext() {
  if (!answers[current]) {
    card.style.transform = "translateX(8px)";
    setTimeout(()=>{ card.style.transform="translateX(-8px)";
      setTimeout(()=>{ card.style.transform=""; }, 80); }, 80);
    return;
  }
  if (current < TOTAL - 1) { current++; renderQuestion("right"); }
  else { checkAuthThenResult(); }
}
function goBack() {
  if (current > 0) { current--; renderQuestion("left"); }
}

/* ‚îÄ‚îÄ AUTH CHECK ‚îÄ‚îÄ */
function checkAuthThenResult() {
  progWrap.style.display = "none";
  const user = window._fbUser;
  if (user) {
    computeAndShow(user);
  } else {
    window._onAuthReady = (u) => { window._onAuthReady = null; computeAndShow(u); };
    showAuthScreen();
  }
}

/* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
function showAuthScreen() {
  emailExpanded = false;
  setContent(`
    <div class="auth-wrap">
      <h1>Kaydolun</h1>
      <p class="auth-subtitle">
        Zaten √ºye misiniz?
        <a onclick="switchToLogin()">Giri≈ü Yapƒ±n</a>
      </p>

      <button class="btn-google" onclick="signInGoogle()">
        <svg width="18" height="18" viewBox="0 0 48 48">
          <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
          <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
          <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
          <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
        </svg>
        Google ile giri≈ü yap
      </button>

      <button class="btn-facebook" onclick="signInFacebook()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
          <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
        </svg>
        Facebook ile hesabƒ±nƒ±zƒ± olu≈üturun
      </button>

      <div class="auth-divider">veya</div>

      <div class="auth-form">
        <div class="auth-error" id="auth-err"></div>
        <button class="btn-email-submit" onclick="toggleEmailForm()">
          E-postanƒ±zla kaydolun
        </button>
        <div class="email-expanded" id="email-form" style="display:none">
          <input id="inp-name"  placeholder="Ad Soyad"        type="text"     autocomplete="name"/>
          <input id="inp-email" placeholder="E-posta adresi"  type="email"    autocomplete="email"/>
          <input id="inp-pass"  placeholder="≈ûifre (min. 6)"  type="password" autocomplete="new-password"/>
          <button class="btn-submit-main" onclick="doRegister()">Kaydol &amp; Sonucu G√∂r</button>
        </div>
      </div>

      <p class="auth-note">
        Kaydolduƒüunuzda profiliniz otomatik olarak kayƒ±t altƒ±na alƒ±nƒ±r.<br>
        Bilgileriniz yalnƒ±zca sonucunuzu g√∂stermek i√ßin kullanƒ±lƒ±r.
      </p>
    </div>
  `, "right");
}

function switchToLogin() {
  emailExpanded = false;
  setContent(`
    <div class="auth-wrap">
      <h1>Giri≈ü Yapƒ±n</h1>
      <p class="auth-subtitle">
        Hesabƒ±nƒ±z yok mu?
        <a onclick="showAuthScreen()">Kaydolun</a>
      </p>

      <button class="btn-google" onclick="signInGoogle()">
        <svg width="18" height="18" viewBox="0 0 48 48">
          <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
          <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
          <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
          <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
        </svg>
        Google ile giri≈ü yap
      </button>

      <button class="btn-facebook" onclick="signInFacebook()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
          <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
        </svg>
        Facebook ile giri≈ü yap
      </button>

      <div class="auth-divider">veya</div>

      <div class="auth-form">
        <div class="auth-error" id="auth-err"></div>
        <input id="inp-email" placeholder="E-posta adresi"  type="email"    autocomplete="email" style="margin-bottom:10px;padding:12px 15px;border:1.5px solid var(--border);border-radius:10px;font-size:14px;width:100%;outline:none;font-family:inherit"/>
        <input id="inp-pass"  placeholder="≈ûifre"           type="password" autocomplete="current-password" style="margin-bottom:10px;padding:12px 15px;border:1.5px solid var(--border);border-radius:10px;font-size:14px;width:100%;outline:none;font-family:inherit"/>
        <button class="btn-email-submit" onclick="doLogin()" style="background:var(--ink);color:white;border-color:var(--ink);">Giri≈ü Yap</button>
      </div>

      <p class="auth-note">Oturum a√ßtƒ±ƒüƒ±nƒ±zda √∂nceki sonucunuz y√ºklenir.</p>
    </div>
  `, "right");
}

function toggleEmailForm() {
  const form = document.getElementById("email-form");
  if (!form) return;
  emailExpanded = !emailExpanded;
  form.style.display = emailExpanded ? "block" : "none";
}

function showAuthError(msg) {
  const el = document.getElementById("auth-err");
  if (el) { el.textContent = msg; el.classList.add("show"); }
}

/* ‚îÄ‚îÄ FIREBASE SIGN-IN ‚îÄ‚îÄ */
async function signInGoogle() {
  const fb = window._fb;
  if (!fb) { showAuthError("Firebase yapƒ±landƒ±rƒ±lmadƒ±."); return; }
  try {
    await fb.signInWithPopup(fb.auth, fb.googleProvider);
    // onAuthStateChanged tetiklenecek ve _onAuthReady √ßaƒürƒ±lacak
  } catch(e) {
    showAuthError("Google ile giri≈ü ba≈üarƒ±sƒ±z: " + (e.message || ""));
  }
}

function signInFacebook() {
  showAuthError("Facebook giri≈üi i√ßin Firebase Console'dan Facebook provider'ƒ± aktif edin.");
}

async function doRegister() {
  const fb    = window._fb;
  const name  = (document.getElementById("inp-name")?.value  || "").trim();
  const email = (document.getElementById("inp-email")?.value || "").trim();
  const pass  = (document.getElementById("inp-pass")?.value  || "").trim();

  if (!fb)    { showAuthError("Firebase yapƒ±landƒ±rƒ±lmadƒ±."); return; }
  if (!name)  { showAuthError("Ad Soyad bo≈ü bƒ±rakƒ±lamaz."); return; }
  if (!email) { showAuthError("E-posta adresi bo≈ü bƒ±rakƒ±lamaz."); return; }
  if (pass.length < 6) { showAuthError("≈ûifre en az 6 karakter olmalƒ±dƒ±r."); return; }

  const btn = document.querySelector(".btn-submit-main");
  if (btn) { btn.disabled = true; btn.textContent = "Kaydediliyor‚Ä¶"; }

  try {
    const cred = await fb.createUserWithEmailAndPassword(fb.auth, email, pass);
    await fb.updateProfile(cred.user, { displayName: name });
    // onAuthStateChanged tetiklenecek
  } catch(e) {
    if (btn) { btn.disabled = false; btn.textContent = "Kaydol & Sonucu G√∂r"; }
    const msgs = {
      "auth/email-already-in-use": "Bu e-posta zaten kullanƒ±lƒ±yor. Giri≈ü yapƒ±n.",
      "auth/invalid-email":        "Ge√ßersiz e-posta adresi.",
      "auth/weak-password":        "≈ûifre √ßok zayƒ±f, en az 6 karakter kullanƒ±n."
    };
    showAuthError(msgs[e.code] || e.message);
  }
}

async function doLogin() {
  const fb    = window._fb;
  const email = (document.getElementById("inp-email")?.value || "").trim();
  const pass  = (document.getElementById("inp-pass")?.value  || "").trim();

  if (!fb)    { showAuthError("Firebase yapƒ±landƒ±rƒ±lmadƒ±."); return; }
  if (!email || !pass) { showAuthError("E-posta ve ≈üifre bo≈ü bƒ±rakƒ±lamaz."); return; }

  try {
    await fb.signInWithEmailAndPassword(fb.auth, email, pass);
  } catch(e) {
    const msgs = {
      "auth/user-not-found":  "Bu e-posta ile kayƒ±tlƒ± hesap bulunamadƒ±.",
      "auth/wrong-password":  "≈ûifre hatalƒ±.",
      "auth/invalid-email":   "Ge√ßersiz e-posta adresi.",
      "auth/invalid-credential": "E-posta veya ≈üifre hatalƒ±."
    };
    showAuthError(msgs[e.code] || e.message);
  }
}

/* ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ */
function computeAndShow(user) {
  const total = Object.values(answers).reduce((a,b) => a+b, 0);
  const profile = profiles.find(p => total >= p.min && total <= p.max);
  const data = {
    name:    user.displayName || user.email,
    email:   user.email,
    photoURL: user.photoURL || null,
    total,
    profile: profile.name,
    icon:    profile.icon,
    desc:    profile.desc,
    date:    new Date().toISOString()
  };
  localStorage.setItem("riskResult_" + user.uid, JSON.stringify(data));
  showResult(data, user);
}

function showResult(data, user) {
  progWrap.style.display = "none";
  const pct = Math.round(((data.total - 30) / (180 - 30)) * 100);

  const initial = (data.name || "?")[0].toUpperCase();
  const avatarHtml = data.photoURL
    ? `<img src="${data.photoURL}" alt=""/>`
    : initial;

  setContent(`
    <div class="user-bar">
      <div class="user-avatar">${avatarHtml}</div>
      <div class="user-name">${data.name}</div>
      <button class="btn-signout" onclick="doSignOut()">√áƒ±kƒ±≈ü yap</button>
    </div>
    <div class="result-body">
      <div class="result-icon">${data.icon || "‚ú¶"}</div>
      <div class="result-label">Risk Profiliniz</div>
      <div class="result-profile">${data.profile}</div>
      <div class="result-score">Toplam Skor: ${data.total} / 150</div>

      <div class="score-bar-wrap">
        <div class="score-bar-labels">
          <span>Koruma</span><span>Dengeli</span><span>B√ºy√ºme</span><span>Agresif</span>
        </div>
        <div class="score-bar-track">
          <div class="score-bar-fill" id="res-bar" style="width:0%"></div>
        </div>
      </div>

      <p class="result-desc">${data.desc}</p>

      <button class="btn-email-result" id="btn-send-email" onclick="sendResultEmail()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-10 7L2 7"/>
        </svg>
        Sonucu E-posta ile G√∂nder
      </button>
      <div class="email-status" id="email-status"></div>

      <button class="btn-reset" onclick="resetAll()">Testi yeniden ba≈ülat</button>
    </div>
  `, "right");

  requestAnimationFrame(() => requestAnimationFrame(() => {
    const bar = document.getElementById("res-bar");
    if (bar) bar.style.width = pct + "%";
  }));

  window._lastResult = data;
}

async function doSignOut() {
  const fb = window._fb;
  if (fb) await fb.signOut(fb.auth).catch(()=>{});
  window._fbUser = null;
  window._lastResult = null;
  answers = {}; current = 0;
  progWrap.style.display = "";
  renderQuestion("right");
}

/* ‚îÄ‚îÄ EMAIL ‚îÄ‚îÄ */
async function sendResultEmail() {
  const data = window._lastResult;
  if (!data) return;
  const btn    = document.getElementById("btn-send-email");
  const status = document.getElementById("email-status");

  if (EMAILJS_PUBLIC_KEY === "YOUR_PUBLIC_KEY") {
    const sub  = encodeURIComponent("Risk Profili Sonucunuz ‚Äì Yatƒ±rƒ±m Atlasƒ±");
    const body = encodeURIComponent(
      `Merhaba ${data.name},\n\n` +
      `üìä Risk Profiliniz: ${data.profile}\n` +
      `üî¢ Toplam Skor: ${data.total} / 150\n\n` +
      `${data.desc}\n\n` +
      `Tarih: ${new Date(data.date).toLocaleDateString('tr-TR')}\n\n‚Äî Yatƒ±rƒ±m Atlasƒ±`
    );
    window.location.href = `mailto:${data.email}?subject=${sub}&body=${body}`;
    return;
  }

  btn.disabled = true;
  btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" style="animation:spin .8s linear infinite"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg> G√∂nderiliyor‚Ä¶`;

  try {
    if (typeof emailjs === "undefined") {
      await loadScript("https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js");
      emailjs.init(EMAILJS_PUBLIC_KEY);
    }
    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
      to_name: data.name, to_email: data.email,
      profile: data.profile, score: data.total + " / 150",
      desc: data.desc, date: new Date(data.date).toLocaleDateString('tr-TR')
    });
    btn.innerHTML = `‚úì G√∂nderildi`;
    status.className = "email-status success";
    status.textContent = `Sonu√ß ${data.email} adresine g√∂nderildi.`;
  } catch(e) {
    btn.disabled = false;
    btn.innerHTML = `Tekrar Dene`;
    status.className = "email-status error";
    status.textContent = "G√∂nderilemedi. EmailJS ayarlarƒ±nƒ± kontrol edin.";
  }
}

function loadScript(src) {
  return new Promise((res, rej) => {
    const s = document.createElement("script");
    s.src = src; s.onload = res; s.onerror = rej;
    document.head.appendChild(s);
  });
}

function resetAll() {
  const fb = window._fb;
  const user = window._fbUser;
  if (user) localStorage.removeItem("riskResult_" + user.uid);
  answers = {}; current = 0; window._lastResult = null;
  progWrap.style.display = "";
  renderQuestion("right");
}

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
// Firebase y√ºklenince oturum kontrol√º yapƒ±lƒ±r
window._onAuthReady = null;

// Sayfa y√ºklendiƒüinde auth state hazƒ±rsa doƒürudan quiz'i g√∂ster
// Eƒüer kullanƒ±cƒ± oturum a√ßƒ±kken sayfayƒ± yeniden y√ºklerse
// ve quiz tamamlandƒ±ysa √∂nceki sonucu g√∂ster
setTimeout(() => {
  const user = window._fbUser;
  if (user) {
    const saved = localStorage.getItem("riskResult_" + user.uid);
    if (saved) { showResult(JSON.parse(saved), user); return; }
  }
  if (!card.innerHTML) renderQuestion("right");
}, 800);

renderQuestion("right");
</script>
</body>
</html>
