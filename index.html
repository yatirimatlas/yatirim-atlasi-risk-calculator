<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yatırımcı Risk Profili | Yatırım Atlası</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  html, body {
    margin:0;
    padding:0;
    background:#f3f4f6;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    overflow-x:hidden;
  }
</style>
</head>

<body>

<!-- min-h-screen KALDIRILDI -->
<div class="flex justify-center px-4 py-10">
  <div id="app" class="w-full max-w-xl"></div>
</div>

<script>

/* ---------------- AUTO HEIGHT FOR WIX ---------------- */

function sendHeight(){
  const height = document.documentElement.scrollHeight;
  window.parent.postMessage(height,"*");
}

window.addEventListener("load", sendHeight);
window.addEventListener("resize", sendHeight);

/* ---------------- DATA ---------------- */

const sections = [
  { title:"Risk Alma Kapasitesi", weight:0.20 },
  { title:"Finansal Dayanıklılık", weight:0.15 },
  { title:"Bilgi & Deneyim", weight:0.15 },
  { title:"Psikolojik Dayanıklılık", weight:0.20 },
  { title:"Zaman Ufku", weight:0.15 },
  { title:"Volatilite Yönetimi", weight:0.15 }
];

const questions = [
  "Geçici %30 kaybı tolere edebilir misiniz?",
  "1 yıl negatif getiri sizin için?",
  "Yüksek volatiliteye yaklaşımınız?",
  "Yüksek riskli yatırımlar?",
  "Piyasa düşüşlerinde davranış?"
];

const profiles = [
  { min:0,max:39,name:"Koruyucu"},
  { min:40,max:54,name:"Dengeli"},
  { min:55,max:69,name:"Büyüme Odaklı"},
  { min:70,max:84,name:"Agresif"},
  { min:85,max:100,name:"Profesyonel"}
];

/* ---------------- STATE ---------------- */

let current = 0;
let answers = {};

const app = document.getElementById("app");

/* ---------------- RENDER ---------------- */

function render(){

  const progress = ((current+1)/sections.length)*100;

  app.innerHTML = `
  <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">

    <div class="mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">
        Yatırımcı Risk Profili
      </h1>
      <p class="text-gray-500 mt-1">
        ${current+1} / ${sections.length} — ${sections[current].title}
      </p>

      <div class="w-full bg-gray-200 rounded-full h-2 mt-4">
        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300"
          style="width:${progress}%"></div>
      </div>
  <div class="flex justify-between text-xs text-gray-500 mt-3">
  <span>1 — Hiç rahat değilim</span>
  <span>5 — Son derece rahatım</span>
</div>
    </div>

    ${questions.map((q,i)=>`
      <div class="mb-6">
        <p class="font-medium text-gray-800 mb-3 text-sm sm:text-base">${q}</p>
        <div class="grid grid-cols-5 gap-2">
          ${[1,2,3,4,5].map(v=>`
            <button
              onclick="answer(${current},${i},${v})"
              class="py-2 rounded-lg text-sm font-medium border transition
              ${answers[`${current}-${i}`]==v
                ? 'bg-blue-600 text-white border-blue-600'
                : 'bg-gray-50 border-gray-300 hover:border-blue-400'}
              ">
              ${v}
            </button>
          `).join("")}
        </div>
      </div>
    `).join("")}

    <div class="flex justify-between mt-8">
      <button onclick="prev()"
        class="px-5 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700">
        ← Önceki
      </button>

      ${
        current === sections.length-1
        ? `<button onclick="showResult()"
            class="px-6 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700">
            Sonuçları Gör
          </button>`
        : `<button onclick="next()"
            class="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700">
            Sonraki →
          </button>`
      }
    </div>

  </div>
  `;

  sendHeight();
}

/* ---------------- ANSWER ---------------- */

function answer(s,q,v){
  answers[`${s}-${q}`]=v;
  render();
}

function next(){
  window.scrollTo({top:0,behavior:"smooth"});
  current++;
  render();
}

function prev(){
  window.scrollTo({top:0,behavior:"smooth"});
  current--;
  render();
}

/* ---------------- RESULT ---------------- */

function showResult(){

  const scores = sections.map((s,si)=>{
    let total=0;
    for(let i=0;i<5;i++){
      total += answers[`${si}-${i}`] || 0;
    }
    return (total/25)*100;
  });

  const totalScore = Math.round(
    scores.reduce((t,s,i)=> t + s*sections[i].weight ,0)
  );

  const profile = profiles.find(p=>totalScore>=p.min && totalScore<=p.max);

  app.innerHTML = `
    <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 text-center">

      <h2 class="text-4xl font-bold text-gray-800">${totalScore}/100</h2>
      <p class="text-xl mt-2 mb-6">${profile.name} Yatırımcı</p>

      <canvas id="radar" class="mb-6"></canvas>

      <button onclick="location.reload()"
        class="px-6 py-2 bg-gray-800 text-white rounded-lg hover:bg-black">
        Yeniden Başla
      </button>
    </div>
  `;

  sendHeight();

  new Chart(document.getElementById("radar"),{
    type:"radar",
    data:{
      labels:sections.map(s=>s.title),
      datasets:[{
        data:scores,
        backgroundColor:"rgba(37,99,235,0.2)",
        borderColor:"#2563eb",
        borderWidth:2
      }]
    },
    options:{
      responsive:true,
      scales:{
        r:{min:0,max:100,ticks:{stepSize:20}}
      }
    }
  });
}

render();
</script>

</body>
</html>
